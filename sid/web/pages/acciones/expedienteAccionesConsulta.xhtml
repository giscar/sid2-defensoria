<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

    <ui:composition template="../template/templateCabeceraExpediente.xhtml">
        <ui:define name="content2">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item"> 
                    <a class="nav-link" id="home-tab" data-toggle="tab" href="#home5" role="tab" aria-controls="home5" aria-expanded="true" jsf:action="#{registroController.datosGeneralesExpediente()}">
                        <span class="hidden-sm-up">
                            <i class="ti-home"></i>
                        </span> 
                        <span class="hidden-xs-down">Datos generales</span>
                    </a> 
                </li>
                <li class="nav-item"> 
                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile5" role="tab" aria-controls="profile" jsf:rendered="#{registroController.etapaEstado.idEtapa > 0}" jsf:action="#{registroController.cargarExpedienteGestionLista()}">
                        <span class="hidden-sm-up">
                            <i class="ti-user"></i>
                        </span> 
                        <span class="hidden-xs-down">Gestiones externas</span>
                    </a>
                </li>
                <li class="nav-item"> 
                    <a class="nav-link active" id="profile-tab" data-toggle="tab" href="#profile5" role="tab" aria-controls="profile" jsf:rendered="#{registroController.etapaEstado.idEtapa > 0}" jsf:action="#{registroController.inicioAcciones()}">
                        <span class="hidden-sm-up">
                            <i class="ti-user"></i>
                        </span> 
                        <span class="hidden-xs-down">Gestiones internas</span>
                    </a>
                </li>
                <li class="nav-item"> 
                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile5" role="tab" aria-controls="profile" jsf:action="#{registroController.cargarHistorial()}">
                        <span class="hidden-sm-up">
                            <i class="ti-user"></i>
                        </span> 
                        <span class="hidden-xs-down">Historial</span>
                    </a>
                </li>
                <li class="nav-item"> 
                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile5" role="tab" aria-controls="profile"  jsf:rendered="#{registroController.etapaEstado.idEtapa > 0}" jsf:action="#{registroController.cargarCompartir()}">
                        <span class="hidden-sm-up">
                            <i class="ti-user"></i>
                        </span> 
                        <span class="hidden-xs-down">Compartir</span>
                    </a>
                </li>
            </ul>
            <div class="tab-content tabcontent-border p-20" id="myTabContent">
                <div role="tabpanel" class="tab-pane fade show active" id="home5" aria-labelledby="home-tab">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h:panelGroup rendered="#{registroController.expediente.usuarioRegistro == registroController.usuarioSession.codigo and seguridadUtilController.tieneRecurso('REC_EXP004')}">
                                        <div class="row">
                                            <div class="col-6">
                                                <h4 class="card-title">Realizar consulta</h4>
                                            </div>
                                            <div class="col-2">
                                                <a class="btn btn-warning" jsf:action="#{registroController.limpiarModalConsulta}">
                                                    <span class="fas fa-plus" /> Realizar Consulta
                                                    <f:ajax render="@form" onevent="openModalNuevaConsulta" />
                                                </a>
                                                <script>
                                                    function openModalNuevaConsulta(data) {
                                                        if (data.status === 'success') {
                                                            $("#loadModal").modal('hide');
                                                            $('body').removeClass('modal-open');
                                                            $(".modal-backdrop").removeClass("modal-backdrop");
                                                            $("#idModalNuevaConsulta").modal('show');
                                                        }
                                                    }
                                                </script>
                                                <div id="idModalNuevaConsulta" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;" >
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h4 class="modal-title">Nueva consulta</h4>
                                                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="form-group row">
                                                                    <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la consulta</label>
                                                                    <div class="col-sm-8">
                                                                        <span style="color: red">(max: 4000 carateres)</span>
                                                                        <textarea jsf:value="#{registroController.expedienteConsultaEnvia.detalle}" rows="6" class="form-control" maxlength="4000" placeholder="Detalle de la consulta"/>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group row">
                                                                    <label for="fname" class="col-sm-4 text-right control-label col-form-label">Adjuntía Defensorial</label>
                                                                    <div class="col-sm-8">
                                                                        <h:selectOneMenu value="#{registroController.expedienteConsultaEnvia.idAdjuntiaDefensorial}" class="form-control">
                                                                            <f:selectItem itemLabel="Seleccione" itemValue="0" />
                                                                            <f:selectItems value="#{registroController.listaAdjuntiaDefensoriales}" />
                                                                        </h:selectOneMenu>
                                                                    </div>
                                                                </div>
                                                                <h:panelGroup rendered="#{registroController.expedienteConsultaEnvia.ruta == null}">
                                                                    <div class="form-group row">
                                                                        <label for="fname" class="col-sm-4 text-right control-label col-form-label">Adjuntar archivo</label>
                                                                        <div class="col-sm-8">
                                                                            <h:inputFile id="file0" value="#{registroController.file3}"/>
                                                                        </div>
                                                                    </div>
                                                                </h:panelGroup>
                                                                <h:panelGroup rendered="#{registroController.expedienteConsultaEnvia.ruta != null}">
                                                                    <div class="form-group row">
                                                                        <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                        <div class="col-sm-8">
                                                                            <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteConsultaEnvia.ruta}">
                                                                                <span class="fas fa-link" /> #{registroController.expedienteConsultaEnvia.ruta}
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </h:panelGroup>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <a class="btn btn-info" data-dismiss="modal" jsf:action="#{registroController.enviarConsulta(1)}">
                                                                    <span class="fa fa-save"/> Guardar
                                                                </a>
                                                                <a class="btn btn-danger" data-dismiss="modal">
                                                                    <span class="fas fa-times" style="color: white"/> <span style="color: white">Cerrar</span>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br/><br/>
                                        <div class="table-responsive">
                                            <h:dataTable value="#{registroController.listaExpedienteTotalesEnvia}" var="envia" class="table table-hover" binding="#{it}" rendered="#{registroController.listaExpedienteTotalesEnvia.size() > 0}">
                                                <h:column>
                                                    <f:facet name="header">N°</f:facet>
                                                    <h:outputText value="#{it.rowIndex + 1}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Código</f:facet>
                                                    <h:outputText value="#{envia.codigo}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Etapa</f:facet>
                                                    <h:outputText value="#{envia.etapa}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Comisionado</f:facet>
                                                    <h:outputText value="#{envia.nombreUsuario}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Adjuntía Defensorial</f:facet>
                                                    <h:outputText value="#{envia.nombreAdjuntia}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Fecha</f:facet>
                                                    <h:outputText value="#{envia.fecha}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Estado</f:facet>
                                                    <h:outputText value="#{envia.estado == 'ACT'? 'Activo' : 'Concluido'}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Archivo consulta</f:facet>
                                                    <h:panelGroup rendered="#{envia.ruta != null}">
                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{envia.ruta}">
                                                            <span class="fas fa-link" /> #{envia.ruta}
                                                        </a>
                                                    </h:panelGroup>    
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">ver respuesta</f:facet>
                                                    <a jsf:rendered="#{envia.etapa == 6}" jsf:action="#{registroController.limpiarModalRespuestaRecibe(envia)}">
                                                        <span class="fas fa-search" /> ver
                                                        <f:ajax render="@form" onevent="openModalRecibeRespuesta" />
                                                    </a>
                                                </h:column>
                                            </h:dataTable>
                                        </div>
                                        <script>
                                            function openModalRecibeRespuesta(data) {
                                                if (data.status === 'success') {
                                                    $("#loadModal").modal('hide');
                                                    $('body').removeClass('modal-open');
                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                    $("#idModalRecibeRespuesta").modal('show');
                                                }
                                            }
                                        </script>
                                        <h:panelGroup id="idPanelRespuestaAcepta">
                                            <div id="idModalRecibeRespuesta" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;" >
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Respuesta</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Comisionado que envía</label>
                                                                <div class="col-sm-8">
                                                                    <label class="control-label col-form-label">#{registroController.expedienteRespuestaRecibe.nombreUsuario}</label>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la consulta</label>
                                                                <div class="col-sm-8">
                                                                    <h:outputLabel class="control-label col-form-label" value="#{registroController.expedienteRespuestaRecibe.detalle}" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Archivo consulta</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteRespuestaRecibe.ruta != null}">
                                                                        <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteRespuestaRecibe.ruta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteRespuestaRecibe.ruta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <h:outputLabel class="control-label col-form-label" value="#{registroController.expedienteRespuestaRecibe.respuesta}" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Archivo respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteRespuestaRecibe.rutaRespuesta != null}">
                                                                        <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteRespuestaRecibe.rutaRespuesta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteRespuestaRecibe.rutaRespuesta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <a class="btn btn-danger" data-dismiss="modal">
                                                                <span class="fas fa-times" style="color: white"/> <span style="color: white">Cerrar</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </h:panelGroup>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{seguridadUtilController.tieneRecurso('REC_EXP005') and registroController.esSupervisor}">
                                        <div class="table-responsive">
                                            <h:dataTable value="#{registroController.listaExpedienteTotalesAprueba}" var="aprueba" class="table table-hover" binding="#{it1}" rendered="#{registroController.listaExpedienteTotalesAprueba.size() > 0}">
                                                <h:column>
                                                    <f:facet name="header">N°</f:facet>
                                                    <h:outputText value="#{it1.rowIndex + 1}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Código</f:facet>
                                                    <h:outputText value="#{aprueba.codigo}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Etapa</f:facet>
                                                    <h:outputText value="#{aprueba.etapa}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Ultimo envio</f:facet>
                                                    <h:outputText value="#{aprueba.nombreUsuario}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Adjuntía Defensorial</f:facet>
                                                    <h:outputText value="#{aprueba.nombreAdjuntia}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Fecha</f:facet>
                                                    <h:outputText value="#{aprueba.fecha}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Estado</f:facet>
                                                    <h:outputText value="#{aprueba.estado == 'ACT'? 'Activo' : 'Concluido'}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Archivo consulta</f:facet>
                                                    <h:panelGroup rendered="#{aprueba.ruta != null}">
                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{aprueba.ruta}">
                                                            <span class="fas fa-link" /> #{aprueba.ruta}
                                                        </a>
                                                    </h:panelGroup>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Responder</f:facet>
                                                    <a jsf:rendered="#{aprueba.etapa == 1 and aprueba.estado == 'ACT'}" jsf:action="#{registroController.limpiarModalConsultaAprueba(aprueba)}">
                                                        <span class="fas fa-pencil-alt" />
                                                        <f:ajax render="@form" onevent="openModalNuevaAprobar" />
                                                    </a>
                                                    <a jsf:rendered="#{aprueba.etapa == 5 and aprueba.estado == 'ACT'}" jsf:action="#{registroController.limpiarModalRespuestaAcepta(aprueba)}">
                                                        <span class="fas fa-pencil-alt" />
                                                        <f:ajax render="@form" onevent="openModalNuevaRespuesAcepta" />
                                                    </a>
                                                </h:column>
                                                <h:column rendered="#{seguridadUtilController.tieneRecurso('REC_EXP004') and registroController.esSupervisor and registroController.expediente.usuarioRegistro == registroController.usuarioSession.codigo}">
                                                    <f:facet name="header">ver respuesta</f:facet>
                                                    <a jsf:rendered="#{aprueba.etapa == 6}" jsf:action="#{registroController.limpiarModalRespuestaRecibe(aprueba)}">
                                                        <span  class="fas fa-search" />
                                                        <f:ajax render="@form" onevent="openModalRecibeRespuesta" />
                                                    </a>
                                                </h:column>
                                            </h:dataTable>
                                        </div>
                                        <script>
                                            function openModalNuevaAprobar(data) {
                                                if (data.status === 'success') {
                                                    $("#loadModal").modal('hide');
                                                    $('body').removeClass('modal-open');
                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                    $("#idModalNuevaAprobar").modal('show');
                                                }
                                            }
                                            function openModalNuevaRespuesAcepta(data) {
                                                if (data.status === 'success') {
                                                    $("#loadModal").modal('hide');
                                                    $('body').removeClass('modal-open');
                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                    $("#idModalNuevaRespuesAcepta").modal('show');
                                                }
                                            }
                                        </script>
                                        <h:panelGroup id="idModalConsultaAprobar">
                                            <div id="idModalNuevaAprobar" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;" >
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Aprobar / desaprobar envio de consulta</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Comisionado que envía</label>
                                                                <div class="col-sm-8">
                                                                    <label class="control-label col-form-label">#{registroController.expedienteConsultaAprueba.nombreUsuario}</label>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la consulta</label>
                                                                <div class="col-sm-8">
                                                                    <span style="color: red">(max: 4000 carateres)</span>
                                                                    <textarea jsf:value="#{registroController.expedienteConsultaAprueba.detalle}" rows="6" class="form-control" maxlength="4000" placeholder="Detalle de la consulta"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <h:selectOneRadio value="#{registroController.expedienteConsultaAprueba.aprueba}">
                                                                        <f:selectItem itemLabel="Aprobar" itemValue="SI" />
                                                                        <f:selectItem itemLabel="Desaprobar" itemValue="NO" />
                                                                    </h:selectOneRadio>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Oficina Defensorial:</label>
                                                                <div class="col-sm-8">
                                                                    <h:selectOneMenu value="#{registroController.expedienteConsultaAprueba.idAdjuntiaDefensorial}" class="form-control">
                                                                        <f:selectItem itemLabel="Seleccione" itemValue="0" />
                                                                        <f:selectItems value="#{registroController.listaAdjuntiaDefensoriales}" />
                                                                    </h:selectOneMenu>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Cambiar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:inputFile id="file1" value="#{registroController.file7}" class="form-control"/>
                                                                </div>
                                                            </div>                                    
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteConsultaAprueba.ruta != null}">
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteConsultaAprueba.ruta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteConsultaAprueba.ruta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>                                 
                                                        </div>
                                                        <div class="modal-footer">
                                                            <a class="btn btn-info" data-dismiss="modal" jsf:action="#{registroController.enviarAprobacion()}">
                                                                <span class="fa fa-save"/> Guardar
                                                            </a>
                                                            <a class="btn btn-danger" data-dismiss="modal">
                                                                <span class="fas fa-times" style="color: white"/> <span style="color: white">Cerrar</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </h:panelGroup> 
                                        <h:panelGroup id="idModalRespuestaAcepta">
                                            <div id="idModalNuevaRespuesAcepta" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;" >
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Aceptar / rechazar respuesta</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Comisionado que envía</label>
                                                                <div class="col-sm-8">
                                                                    <label class="control-label col-form-label">#{registroController.expedienteRespuestaAcepta.nombreUsuario}</label>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la consulta</label>
                                                                <div class="col-sm-8">
                                                                    <span style="color: red">(max: 4000 carateres)</span>
                                                                    <h:outputLabel value="#{registroController.expedienteRespuestaAcepta.detalle}" class="control-label col-form-label" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteRespuestaAcepta.ruta != null}">
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteRespuestaAcepta.ruta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteRespuestaAcepta.ruta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>  
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <span style="color: red">(max: 4000 carateres)</span>
                                                                    <textarea jsf:value="#{registroController.expedienteRespuestaAcepta.respuesta}" rows="6" class="form-control" maxlength="4000" placeholder="Detalle de la respuesta"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Acepta / rechaza</label>
                                                                <div class="col-sm-8">
                                                                    <h:selectOneRadio value="#{registroController.expedienteRespuestaAcepta.aprueba}">
                                                                        <f:selectItem itemLabel="Aceptar" itemValue="SI" />
                                                                        <f:selectItem itemLabel="Rechazar" itemValue="NO" />
                                                                    </h:selectOneRadio>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Cambiar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:inputFile value="#{registroController.file6}" class="form-control"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteRespuestaAcepta.rutaRespuesta != null}">
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteRespuestaAcepta.rutaRespuesta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteRespuestaAcepta.rutaRespuesta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <a class="btn btn-info" data-dismiss="modal" jsf:action="#{registroController.respuestaAceptar()}">
                                                                <span class="fa fa-save"/> Guardar
                                                            </a>
                                                            <a class="btn btn-danger" data-dismiss="modal">
                                                                <span class="fas fa-times" style="color: white"/> <span style="color: white">Cerrar</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </h:panelGroup> 
                                    </h:panelGroup>       
                                    <h:panelGroup rendered="#{seguridadUtilController.tieneRecurso('REC_EXP006') and registroController.listaExpedienteTotalesReasigna.size() > 0}">
                                        <div class="table-responsive">
                                            <h:dataTable value="#{registroController.listaExpedienteTotalesReasigna}" var="reasigna" class="table table-hover" binding="#{it2}" rendered="#{registroController.listaExpedienteTotalesReasigna.size() > 0}">
                                                <h:column>
                                                    <f:facet name="header">N°</f:facet>
                                                    <h:outputText value="#{it2.rowIndex + 1}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Código</f:facet>
                                                    <h:outputText value="#{reasigna.codigo}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Etapa</f:facet>
                                                    <h:outputText value="#{reasigna.etapa}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Ultimo envio</f:facet>
                                                    <h:outputText value="#{reasigna.nombreUsuario}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Adjuntía Defensorial</f:facet>
                                                    <h:outputText value="#{reasigna.nombreAdjuntia}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Fecha</f:facet>
                                                    <h:outputText value="#{reasigna.fecha}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Estado</f:facet>
                                                    <h:outputText value="#{reasigna.estado == 'ACT'? 'Activo' : 'Concluido'}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Archivo consulta</f:facet>
                                                    <h:panelGroup rendered="#{reasigna.ruta != null}">
                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{reasigna.ruta}">
                                                            <span class="fas fa-link" />#{reasigna.ruta}
                                                        </a>
                                                    </h:panelGroup>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Responde</f:facet>
                                                    <a jsf:rendered="#{reasigna.etapa == 2 and reasigna.estado == 'ACT'}" jsf:action="#{registroController.limpiarModalConsultaReasigna(reasigna)}">
                                                        <span class="fas fa-pencil-alt" />
                                                        <f:ajax render="@form" onevent="openModalNuevaReasigna" />
                                                    </a>
                                                    <a jsf:rendered="#{reasigna.etapa == 4 and reasigna.estado == 'ACT'}" jsf:action="#{registroController.limpiarModalRespuestaAprueba(reasigna)}">
                                                        <span class="fas fa-pencil-alt" />
                                                        <f:ajax render="@form" onevent="openModalNuevaRespuesAprueba" />
                                                    </a>
                                                </h:column>
                                            </h:dataTable>
                                        </div>
                                        <script>
                                            function openModalNuevaReasigna(data) {
                                                if (data.status === 'success') {
                                                    $("#loadModal").modal('hide');
                                                    $('body').removeClass('modal-open');
                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                    $("#idModalNuevaReasigna").modal('show');
                                                }
                                            }
                                            function openModalNuevaRespuesAprueba(data) {
                                                if (data.status === 'success') {
                                                    $("#loadModal").modal('hide');
                                                    $('body').removeClass('modal-open');
                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                    $("#idModalNuevaRespuesAprueba").modal('show');
                                                }
                                            }
                                        </script>
                                        <h:panelGroup id="idModalConsultaReasigna">
                                            <div id="idModalNuevaReasigna" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;" >
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Aprobar / desaprobar recepción de la consulta</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Envía</label>
                                                                <div class="col-sm-8">
                                                                    <label class="control-label col-form-label">#{registroController.expedienteConsultaReasigna.nombreUsuario}</label>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la consulta</label>
                                                                <div class="col-sm-8">
                                                                    <span style="color: red">(max: 4000 carateres)</span>
                                                                    <textarea jsf:value="#{registroController.expedienteConsultaReasigna.detalle}" rows="6" class="form-control" maxlength="4000" placeholder="Detalle de la consulta"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <h:selectOneRadio value="#{registroController.expedienteConsultaReasigna.aprueba}">
                                                                        <f:selectItem itemLabel="Aceptar" itemValue="SI" />
                                                                        <f:selectItem itemLabel="Rechazar" itemValue="NO" />
                                                                        <f:ajax render="idPanelreasignarConsul" />
                                                                    </h:selectOneRadio>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Comisionado asignado a la consulta:</label>
                                                                <div class="col-sm-8">
                                                                    <h:selectOneMenu value="#{registroController.expedienteConsultaReasigna.codigoUsuarioReasignado}" class="form-control">
                                                                        <f:selectItem itemLabel="Seleccione" itemValue="0" />
                                                                        <f:selectItems value="#{registroController.listaUsuariosComisionadosPorAD}" />
                                                                    </h:selectOneMenu>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Comisionado asignado a la consulta</label>
                                                                <div class="col-sm-8">
                                                                    <h:selectOneMenu value="#{registroController.expedienteConsultaReasigna.codigoUsuarioReasignado}" class="form-control">
                                                                        <f:selectItem itemLabel="Seleccione" itemValue="0" />
                                                                        <f:selectItems value="#{registroController.listaUsuariosComisionadosPorAD}" />
                                                                    </h:selectOneMenu>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Cambiar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:inputFile value="#{registroController.file3}" class="form-control"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteConsultaReasigna.ruta}">
                                                                        <span class="fas fa-link" /> #{registroController.expedienteConsultaReasigna.ruta}
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <a class="btn btn-info" data-dismiss="modal" jsf:action="#{registroController.reasignarConsulta()}">
                                                                <span class="fa fa-save"/> Guardar
                                                            </a>
                                                            <a class="btn btn-danger" data-dismiss="modal">
                                                                <span class="fas fa-times" style="color: white"/> <span style="color: white">Cerrar</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </h:panelGroup> 
                                        <h:panelGroup id="idModalRespuestaAprueba">
                                            <div id="idModalNuevaRespuesAprueba" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;" >
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Aprobar / desaprobar respuesta</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Envía</label>
                                                                <div class="col-sm-8">
                                                                    <label class="control-label col-form-label">#{registroController.expedienteRespuestaAprueba.nombreUsuario}</label>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la consulta</label>
                                                                <div class="col-sm-8">
                                                                    <h:outputLabel style="text-align: justify" class="control-label col-form-label" value="#{registroController.expedienteRespuestaAprueba.detalle}" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteRespuestaAprueba.ruta != null}">
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteRespuestaAprueba.ruta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteRespuestaAprueba.ruta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <span style="color: red">(max: 4000 carateres)</span>
                                                                    <textarea jsf:value="#{registroController.expedienteRespuestaAprueba.respuesta}" rows="6" class="form-control" maxlength="4000" placeholder="Detalle de la respuesta"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <h:selectOneRadio value="#{registroController.expedienteRespuestaAprueba.aprueba}">
                                                                        <f:selectItem itemLabel="Aceptar" itemValue="SI" />
                                                                        <f:selectItem itemLabel="Rechazar" itemValue="NO" />
                                                                    </h:selectOneRadio>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Cambiar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:inputFile value="#{registroController.file6}" class="form-control"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Archivo de respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteRespuestaAprueba.rutaRespuesta != null}">
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteRespuestaAprueba.rutaRespuesta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteRespuestaAprueba.rutaRespuesta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <a class="btn btn-info" data-dismiss="modal" jsf:action="#{registroController.respuestaAprobar()}">
                                                                <span class="fa fa-save"/> Guardar
                                                            </a>
                                                            <a class="btn btn-danger" data-dismiss="modal">
                                                                <span class="fas fa-times" style="color: white"/> <span style="color: white">Cerrar</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </h:panelGroup> 
                                    </h:panelGroup>                 
                                    <h:panelGroup rendered="#{seguridadUtilController.tieneRecurso('REC_EXP007') and registroController.listaExpedienteTotalesResponde.size() > 0}">
                                        <div class="table-responsive">
                                            <h:dataTable value="#{registroController.listaExpedienteTotalesResponde}" var="responde" class="table table-hover" binding="#{it3}" rendered="#{registroController.listaExpedienteTotalesResponde.size() > 0}">
                                                <h:column>
                                                    <f:facet name="header">N°</f:facet>
                                                    <h:outputText value="#{it3.rowIndex + 1}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Código</f:facet>
                                                    <h:outputText value="#{responde.codigo}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Etapa</f:facet>
                                                    <h:outputText value="#{responde.etapa}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Ultimo envio</f:facet>
                                                    <h:outputText value="#{responde.nombreUsuario}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Adjuntía Defensorial</f:facet>
                                                    <h:outputText value="#{responde.nombreAdjuntia}" />
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Fecha</f:facet>
                                                    <h:outputText value="#{responde.fecha}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Estado</f:facet>
                                                    <h:outputText value="#{responde.estado == 'ACT'? 'Activo' : 'Concluido'}" >
                                                        <f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Lima" />
                                                    </h:outputText>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Archivo consulta</f:facet>
                                                    <h:panelGroup rendered="#{responde.ruta != null}">
                                                        <a target="_blank" href="/filesystem/#{responde.ruta}">
                                                            <span style="font-size: large" class="glyphicon glyphicon-link" />
                                                        </a>
                                                    </h:panelGroup>
                                                </h:column>
                                                <h:column>
                                                    <f:facet name="header">Responder</f:facet>
                                                    <a jsf:rendered="#{responde.etapa == 3 and responde.estado == 'ACT'}" jsf:action="#{registroController.limpiarModalConsultaResponde(responde)}">
                                                        <span style="font-size: large" class="glyphicon glyphicon-pencil" />
                                                        <f:ajax render="@form" onevent="openModalNuevaReasigna" />
                                                    </a>
                                                </h:column>
                                            </h:dataTable>
                                        </div>                   
                                        <script>
                                            function openModalNuevaReasigna(data) {
                                                if (data.status === 'success') {
                                                    $("#loadModal").modal('hide');
                                                    $('body').removeClass('modal-open');
                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                    $("#idModalNuevaResponde").modal('show');
                                                }
                                            }
                                        </script>
                                        <h:panelGroup id="idModalConsultaResponde">
                                            <div id="idModalNuevaResponde" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;" >
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Responder consulta</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Envía</label>
                                                                <div class="col-sm-8">
                                                                    <label class="control-label col-form-label">#{registroController.expedienteConsultaResponde.nombreUsuario}</label>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la consulta</label>
                                                                <div class="col-sm-8">
                                                                    <h:outputLabel style="text-align: justify" class="control-label col-form-label" value="#{registroController.expedienteConsultaResponde.detalle}" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Descargar archivo</label>
                                                                <div class="col-sm-8">
                                                                    <h:panelGroup rendered="#{registroController.expedienteConsultaResponde.ruta != null}">
                                                                        <a target="_blank" href="/sid/DownloadFileServlet?fileName=#{registroController.expedienteConsultaResponde.ruta}">
                                                                            <span class="fas fa-link" /> #{registroController.expedienteConsultaResponde.ruta}
                                                                        </a>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Detalle de la respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <span style="color: red">(max: 4000 carateres)</span>
                                                                    <textarea jsf:value="#{registroController.expedienteConsultaResponde.respuesta}" rows="6" class="form-control" maxlength="4000" placeholder="Detalle de la respuesta"/>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <label for="fname" class="col-sm-4 text-right control-label col-form-label">Archivo de respuesta</label>
                                                                <div class="col-sm-8">
                                                                    <h:inputFile value="#{registroController.file6}" class="form-control"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <a class="btn btn-info" data-dismiss="modal" jsf:action="#{registroController.responderConsulta()}">
                                                                <span class="fa fa-save"/> Guardar
                                                            </a>
                                                            <a class="btn btn-danger" data-dismiss="modal">
                                                                <span class="fas fa-times" style="color: white"/> <span style="color: white">Cerrar</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </h:panelGroup> 
                                    </h:panelGroup>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ui:define>
    </ui:composition>
</html>